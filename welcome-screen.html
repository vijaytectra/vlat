<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Welcome to VLAT - Successfully logged in" />
    <title>Welcome Screen – VLAT</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Compiled Tailwind CSS -->
    <link rel="stylesheet" href="css/main.css?v=2.0" />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>

  <body class="font-['Inter'] bg-cream lg:min-h-screen">
    <main class="lg:min-h-screen grid grid-cols-1 lg:grid-cols-[72px_1fr]">
      <!-- LEFT RED STRIP -->
      <aside class="hidden lg:block bg-primary w-64"></aside>

      <!-- CONTENT -->
      <section
        class="relative flex flex-col items-center justify-between py-10 px-4"
      >
        <!-- Language Switcher -->
        <div class="absolute top-4 right-4 z-10">
          <div
            class="language-switcher flex items-center gap-0 border border-grey-5 rounded-lg overflow-hidden bg-white"
          >
                <button
                  data-lang="en"
                  class="lang-btn px-3 py-1.5 text-sm font-medium transition-colors active"
                >
                  English
                </button>
                <button
                  data-lang="ta"
                  class="lang-btn px-3 py-1.5 text-sm font-medium transition-colors inactive"
                >
                  தமிழ்
            </button>
          </div>
        </div>
        <!-- SUCCESS BADGE -->
        <div class="self-centerlg:self-center mt-2">
          <div
            class="inline-flex items-center justify-center gap-2 px-4 py-2 bg-successBg border border-successText/40 rounded-full"
          >
            <span class="text-successText text-base font-semibold leading-5" data-i18n="pages.welcomeScreen.successfullyLoggedIn">
              Successfully logged in
            </span>
          </div>
        </div>

        <!-- COUNTDOWN TIMER -->
        <div id="countdownContainer" class="flex flex-col items-center gap-2 mt-4">
          <i class="fas fa-spinner fa-spin text-primary text-2xl"></i>
          <p class="text-grey7 text-lg">
            <span data-i18n="pages.welcomeScreen.redirecting">Redirecting in</span> <span id="countdownNumber">5</span>...
          </p>
        </div>

        <!-- CENTER ILLUSTRATION (DECORATIVE) -->
        <div class="relative w-64 h-64 my-6">
          <img
            src="images/welcome_screen_image.svg"
            alt="Students attending class"
            class="w-full max-w-xl object-contain"
          />
        </div>

        <!-- TEXT BLOCK -->
        <div class="max-w-xl text-center space-y-3">
          <!-- LOGO -->
          <img src="images/logo1.svg" alt="Logo" class="mx-auto h-14" />

          <h1 id="welcomeHeading" class="text-black text-2xl font-semibold" data-i18n="pages.welcomeScreen.welcomeBack">
            Welcome back!
          </h1>

          <p class="text-grey7 text-xl font-normal" data-i18n="pages.welcomeScreen.dashboardReady">
            Your VLAT Entrance Exam dashboard is now ready.
          </p>
        </div>

        <!-- DIVIDER + FOOTER TEXT -->
        <div class="w-full max-w-2xl text-center space-y-3 mt-8">
          <hr class="border-black/20" />
          <p class="text-grey7 text-xl font-normal" data-i18n="pages.welcomeScreen.accessDetails">
            Access your exam details, updates, and progress instantly.
          </p>
        </div>
      </section>
    </main>
    <!-- Translation System -->
    <script src="js/translations.js"></script>
    <script type="module">
      import { getUserData } from "./js/auth.js";

      const welcomeHeading = document.getElementById("welcomeHeading");
      const countdownNumber = document.getElementById("countdownNumber");
      const COUNTDOWN_DURATION = 5; // seconds

      // Fetch user data and update welcome message
      async function initializeWelcome() {
        try {
          const result = await getUserData();
          if (result.success && result.user && result.user.name) {
            // Extract first name or use full name
            const userName = result.user.name.split(" ")[0] || result.user.name;
            const welcomeText = window.t("pages.welcomeScreen.welcomeBack", "Welcome back");
            welcomeHeading.textContent = `${welcomeText} ${userName}!`;
          } else {
            // Fallback to generic welcome
            welcomeHeading.textContent = window.t("pages.welcomeScreen.welcomeBack", "Welcome back!");
          }
        } catch (error) {
          console.error("Error fetching user data:", error);
          // Fallback to generic welcome
          welcomeHeading.textContent = window.t("pages.welcomeScreen.welcomeBack", "Welcome back!");
        }
      }

      // Start countdown timer
      function startCountdown() {
        let countdown = COUNTDOWN_DURATION;
        countdownNumber.textContent = countdown;

        const interval = setInterval(() => {
          countdown--;
          countdownNumber.textContent = countdown;

          if (countdown <= 0) {
            clearInterval(interval);
            // Redirect to dashboard
            window.location.href = "dashboard.html";
          }
        }, 1000);
      }

      // Initialize translations and welcome
      async function init() {
        await initializeTranslations();
        await initializeWelcome();
        startCountdown();
      }

      // Initialize on page load
      init();
    </script>
  </body>
</html>
