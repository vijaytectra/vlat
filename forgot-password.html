<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Forgot Password</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#8D191C",
              cream: "#FFF6E5",
              gold: "#EDCD88",
              whiteSoft: "#F3F4F6",
            },
          },
        },
      };
    </script>
    <style>
      input::placeholder {
        color: #a3a3a3;
        font-size: 0.875rem;
        font-weight: 500;
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>

  <body class="font-['Inter']" style="background-color: #fff6e2">
    <!-- ROOT GRID -->
    <main class="grid grid-cols-1 lg:grid-cols-[96px_1.2fr_1fr]">
      <!-- LEFT RED STRIP -->
      <aside class="hidden lg:block w-72 bg-primary relative">
        <button
          onclick="history.back()"
          class="absolute top-6 left-32 flex items-center gap-2 text-sm font-medium uppercase border border-white/40 rounded-full px-3 py-1 text-[#A3A3A3] backdrop-blur"
        >
          <i class="fas fa-chevron-left text-xs"></i>
          BACK
        </button>
      </aside>

      <section
        class="hidden z-10 lg:flex items-center justify-start h-full px-10 pt-10"
      >
        <img
          src="images/loginImage.svg"
          alt="Students attending class"
          class="h-full max-h-[85%] w-auto object-contain"
        />
      </section>

      <!-- FORM COLUMN -->
      <!-- FORM COLUMN -->
      <section class="flex items-start justify-center px-4 pt-20">
        <div class="w-full max-w-md space-y-4">
          <!-- LOGO -->
          <div class="flex justify-center">
            <img src="images/logo1.svg" alt="VMLS Logo" class="h-14" />
          </div>

          <!-- TITLE -->
          <div class="text-center space-y-1">
            <h1 class="text-3xl font-bold text-primary">Forgot Password</h1>
            <p class="text-sm leading-6 text-[#404040]">
              Enter your registered email to receive a password reset link.
            </p>
          </div>

          <!-- FORM CARD -->
          <form
            id="forgotPasswordForm"
            class="rounded-3xl p-6 space-y-4 bg-primary"
          >
            <!-- ERROR MESSAGE -->
            <div
              id="errorMessage"
              class="hidden flex items-center gap-2 bg-white text-red-600 text-xs px-3 py-2 rounded-full"
            >
              <i class="fas fa-circle-exclamation"></i>
              <span id="errorText"></span>
            </div>

            <!-- Email -->
            <div>
              <label class="text-sm text-[#F3F4F6]">Email Address</label>
              <input
                id="email"
                type="email"
                placeholder="Enter your registered email"
                class="mt-1 w-full h-10 rounded-md bg-[#FFFFFF1A] border border-[#FFFFFF33] px-3 text-white outline-none"
                style="color: #ffffff"
                required
              />
            </div>

            <!-- Button -->
            <button
              type="submit"
              id="submitButton"
              class="w-full h-11 rounded-lg bg-[#FFF6E2] text-primary font-medium disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span id="submitButtonText">Send Reset Link</span>
              <span id="submitButtonLoader" class="hidden">
                <i class="fas fa-spinner fa-spin"></i> Sending...
              </span>
            </button>

            <p class="text-center text-sm text-[#FAFAFA]">
              If your email is registered, you will receive a reset link shortly
              on email.
            </p>

            <!-- Help -->
            <div
              class="border-t border-[#FFFFFF33] pt-3 space-y-2 text-[#D4D4D4] text-xs"
            >
              <p class="text-center">Need help with login?</p>
              <div class="flex justify-between">
                <span
                  ><i class="fas fa-envelope"></i> admissions@vmls.edu.in</span
                >
                <span><i class="fas fa-phone"></i> +91 73582 01234</span>
              </div>
            </div>
          </form>
        </div>
      </section>
    </main>
    <script type="module">
      import { forgotPassword } from "./js/auth.js";

      const form = document.getElementById("forgotPasswordForm");
      const emailInput = document.getElementById("email");
      const errorMessage = document.getElementById("errorMessage");
      const errorText = document.getElementById("errorText");
      const submitButton = document.getElementById("submitButton");
      const submitButtonText = document.getElementById("submitButtonText");
      const submitButtonLoader = document.getElementById("submitButtonLoader");

      // Hide error message initially
      errorMessage.classList.add("hidden");

      function showError(message) {
        errorText.textContent = message;
        errorMessage.classList.remove("hidden");
      }

      function hideError() {
        errorMessage.classList.add("hidden");
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        hideError();

        const email = emailInput.value.trim();

        // Validate email
        if (!email) {
          showError("Please enter your email address");
          return;
        }

        const emailRegex = /^\S+@\S+\.\S+$/;
        if (!emailRegex.test(email)) {
          showError("Please enter a valid email address");
          return;
        }

        // Show loading state
        submitButton.disabled = true;
        submitButtonText.classList.add("hidden");
        submitButtonLoader.classList.remove("hidden");

        try {
          const result = await forgotPassword(email);

          if (result.success) {
            // Redirect to check your email page
            window.location.href = "check-your-email.html";
          } else {
            showError(
              result.message || "Failed to send reset link. Please try again."
            );
            submitButton.disabled = false;
            submitButtonText.classList.remove("hidden");
            submitButtonLoader.classList.add("hidden");
          }
        } catch (error) {
          console.error("Forgot password error:", error);
          showError("An error occurred. Please try again.");
          submitButton.disabled = false;
          submitButtonText.classList.remove("hidden");
          submitButtonLoader.classList.add("hidden");
        }
      });
    </script>
  </body>
</html>
